(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{1082:function(a,e,t){"use strict";t.r(e);var n=t(0),r=t.n(n),i=t(7),s=t(28),o=t(42),l=t.n(o),c=t(131),m=t(18),p=t(41),d=t(197),g=t(198),h=t(5),b=t(16),_=t.n(b),u=t(30),k=t(9),E=t(132),N=t(33),S=t(487);class O extends n.Component{constructor(a){super(a),this.state={listDivisi:[],listSales:[],listSupplier:[],listSPK:[],columns:[{dataField:"kode_barcode",text:"Kode barcode",sort:!0},{dataField:"nama_barang",text:"Nama Barang"},{dataField:"merk_barang",text:"Merk"},{dataField:"kwalitas",text:"Kualitas"},{dataField:"ukuran",text:"Ukuran"},{dataField:"qty",text:"Qty"},{dataField:"action",text:"Action",csvExport:!1,headerClasses:"text-center",formatter:(a,e)=>(this.setState({}),r.a.createElement("div",{className:"row text-center"},r.a.createElement("div",{className:"col-12"},r.a.createElement("button",{type:"button",onClick:()=>this.deleteBarang(e),className:"btn btn-danger"},"Hapus",r.a.createElement("i",{className:"fa fa-trash ml-2"})))))}]}}deleteBarang(a){_.a.fire({title:"Anda Yakin !!",text:"Ingin Menghapus Data Ini ?",icon:"warning",position:"top-center",cancelButtonText:"Tidak",showCancelButton:!0,confirmButtonText:"OK",showConfirmButton:!0}).then(e=>{e.isConfirmed&&(Object(m.k)("PermintaanBarang_temp",a.kode_barcode),this.props.dispatch(Object(u.o)()))})}componentDidMount(){this.props.dispatch(Object(h.Nb)()),Object(k.b)("permintaan-barang/generate/no-trx").then(a=>this.props.change("no_permintaan",a.data[0].no_permintaan)),this.props.change("tanggal",Object(N.c)()),Object(k.b)("daftar-service/getDaftarServiceAllActive").then(a=>this.setState({listSPK:a&&a.data})).catch(a=>Object(m.h)("Erorr Get SPK , Detail : ".concat(a.response.data)))}getSPK(a){let e=[],t=this.state.listSPK.filter(e=>e.no_daftar===a);console.log(t.kode_pegawai),this.props.change("pegawai",t[0].kode_pegawai),t[0].detail_barang.forEach(a=>{e.push({kode_barcode:a.kode_barcode,kode_supplier:a.kode_supplier,qty:a.qty})}),localStorage.setItem("PermintaanBarang_temp",JSON.stringify(t[0].detail_barang)),localStorage.setItem("PermintaanBarang_temp_kirim",JSON.stringify(e)),this.props.dispatch(Object(u.o)())}render(){return r.a.createElement("form",{onSubmit:this.props.handleSubmit,autoComplete:!0},r.a.createElement("div",{className:"col-lg-12"},r.a.createElement("div",{className:"col-lg-12"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-lg-2"},r.a.createElement(d.a,{name:"no_permintaan",component:m.c,type:"text",label:"Nomor Permintaan",placeholder:"Masukan Nomor Permintaan",readOnly:!0})),r.a.createElement("div",{className:"col-lg-3"},r.a.createElement(d.a,{name:"no_spk",component:m.e,options:this.state.listSPK.map(a=>{return{value:a.no_daftar,name:"".concat(a.no_daftar," - ").concat(a.nama_customer)}}),type:"text",label:"Nomor Daftar Service",placeholder:"Masukan Nomor Daftar Service",onChange:a=>this.getSPK(a)})),r.a.createElement("div",{className:"col-lg-3"},r.a.createElement(d.a,{name:"pegawai",component:m.e,options:this.props.listsales.filter(a=>"MKN"===a.kode_divisi).map(a=>{return{value:a.kode_pegawai,name:a.nama_pegawai}}),type:"text",label:"Pegawai",placeholder:"Masukan Pegawai",loading:this.props.onSend,validate:S.a,readOnly:!0})),r.a.createElement("div",{className:"col-lg-3"},r.a.createElement(d.a,{name:"tanggal",component:m.c,type:"date",label:"Tanggal",placeholder:"Masukan Tanggal",validate:S.a}))))),r.a.createElement("div",{className:"col-lg-12 mb-5"},r.a.createElement("div",{className:"text-right"},r.a.createElement("button",{type:"button",className:"btn btn-warning",onClick:()=>this.props.dispatch(Object(h.Wb)())},"Tambah Barang ",r.a.createElement("i",{className:"fa fa-plus ml-3"})))),r.a.createElement("div",{className:"col-lg-12"},this.props.permintaan_temp?r.a.createElement("div",{className:"col-lg-12"},r.a.createElement(E.a,{keyField:"kode_barcode",data:this.props.permintaan_temp||[],columns:this.state.columns,CSVExport:!0,textEmpty:"Silahkan Pilih Nomor Daftar Service untuk melihat barang"})):r.a.createElement(l.a,{width:"100%",height:400})),r.a.createElement("div",{className:"col-lg-12 mb-5 mt-3"},r.a.createElement("div",{className:"text-right"},r.a.createElement("button",{className:"btn btn-primary"},this.props.onSend?r.a.createElement(r.a.Fragment,null,r.a.createElement("i",{className:"fas fa-spinner fa-spin"})," \xa0 Sedang Menyimpan"):r.a.createElement(r.a.Fragment,null,"Simpan ",r.a.createElement("i",{className:"fa fa-paper-plane ml-3 "}))))))}}O=Object(g.a)({form:"permintaanBarang",enableReinitialize:!0})(O);var f=Object(s.b)(a=>({initialValues:{no_permintaan:localStorage.getItem("kode_permintaan_barang")||""},onSend:a.datamaster.onSend,listsales:a.datamaster.listsales}),null)(O),B=t(134),v=t(502),P=t(49);const j=Object(n.lazy)(()=>t.e(115).then(t.bind(null,599)));e.default=Object(s.b)(a=>({permintaan_temp:a.stocking.permintaan_temp}),null)(class extends r.a.Component{constructor(a){super(a),this.state={isEdit:!1,modalDialog:!1,isLoading:!1,datakategori:[{no_acc:"8200930213",nama_bank:"BCA",atas_nama:"OCTAVIAN"}]}}componentDidMount(){localStorage.removeItem("PermintaanBarang_temp"),localStorage.removeItem("PermintaanBarang_temp_kirim"),this.props.dispatch(Object(u.o)()),Object(k.b)("permintaan-barang/generate/no-trx").then(a=>localStorage.setItem("kode_permintaan_barang",a.data[0].no_permintaan))}handleModal(a){let e=JSON.parse(localStorage.getItem("PermintaanBarang_temp_kirim"))||[],t=JSON.parse(localStorage.getItem("PermintaanBarang_temp"))||[],n=e.findIndex(e=>e.kode_barcode===a.kode_barcode),r=t.findIndex(e=>e.kode_barcode===a.kode_barcode);if(-1!==n){let i={kode_barcode:a.kode_barcode,qty:parseInt(a.qty)+parseFloat(e[n].qty),kode_supplier:a.kode_supplier},s={kode_barcode:a.kode_barcode,nama_barang:a.nama_barang,merk_barang:a.merk,kwalitas:a.kwalitas,ukuran:a.ukuran,stock:a.stock,qty:parseInt(a.qty)+parseInt(t[r].qty)};e.splice(n,1),t.splice(r,1),e.push(i),t.push(s),localStorage.setItem("PermintaanBarang_temp",JSON.stringify(t)),localStorage.setItem("PermintaanBarang_temp_kirim",JSON.stringify(e)),Object(m.b)("Berhasil"),this.props.dispatch(Object(P.a)("ModalReturnSupplier")),this.props.dispatch(Object(u.o)())}else{let e={kode_barcode:a.kode_barcode,qty:parseInt(a.qty),kode_supplier:a.kode_supplier},t={kode_barcode:a.kode_barcode,nama_barang:a.nama_barang,merk_barang:a.merk,kwalitas:a.kwalitas,ukuran:a.ukuran,stock:a.stock,qty:a.qty};Object(v.a)("PermintaanBarang_temp",t).then(()=>this.props.dispatch(Object(P.a)("ModalPermintaanBarang"))).then(()=>this.props.dispatch(Object(u.o)())),Object(v.a)("PermintaanBarang_temp_kirim",e).then(()=>this.props.dispatch(Object(P.a)("ModalPermintaanBarang"))).then(()=>this.props.dispatch(Object(u.o)()))}}sendData(a){this.props.dispatch(Object(h.Vb)());let e={no_permintaan:a.no_permintaan,kode_divisi:a.divisi||"MKN",kode_pegawai:a.pegawai,no_daftar_service:a.no_spk,tanggal:a.tanggal,detail_barang:JSON.parse(localStorage.getItem("PermintaanBarang_temp_kirim"))};const t=[];JSON.parse(localStorage.getItem("PermintaanBarang_temp")).forEach((a,e)=>{const n=[++e,a.kode_barcode,a.nama_barang,a.merk_barang,a.kwalitas,a.qty];t.push(n)});let n=["NO","BARCODE","JENIS BARANG","MERK","KW","QTY"];Object(k.c)("permintaan-barang/post-transaksi",e).then(()=>Object(m.b)("Berhasil Menyimpan Data")).then(()=>Object(B.a)("Tanggal",a.tanggal,"PEGAWAI",a.pegawai,"NO PERMINTAAN",a.no_permintaan,"DIVISI",a.divisi,"ADMIN","01-28-2021","ADMIN",n,"BUKTI PERMINTAAN BARANG",t,[],!0)).then(()=>Object(N.d)(["PermintaanBarang_temp_kirim","PermintaanBarang_temp","kode_permintaan_barang"])).then(()=>this.props.dispatch(Object(P.a)("permintaanBarang"))).then(()=>this.props.dispatch(Object(u.o)())).then(()=>this.props.dispatch(Object(h.Ub)())).catch(a=>Object(m.a)(a.response.data).then(()=>this.props.dispatch(Object(h.Ub)())))}render(){return r.a.createElement("div",null,r.a.createElement("ol",{className:"breadcrumb float-xl-right"},r.a.createElement("li",{className:"breadcrumb-item"},r.a.createElement(i.b,{to:"#"},"Data Master")),r.a.createElement("li",{className:"breadcrumb-item active"},"Permintaan Barang")),r.a.createElement("h1",{className:"page-header"},"Permintaan Barang "),r.a.createElement(p.a,null,r.a.createElement(p.c,null,"Permintaan Barang"),r.a.createElement("br",null),r.a.createElement("div",{className:"col-lg-12"},r.a.createElement(f,{onSubmit:a=>this.sendData(a),permintaan_temp:this.props.permintaan_temp})),r.a.createElement("br",null),r.a.createElement(c.a,{title:this.state.isEdit?"Edit Data Permintaan Barang":"Tambah Data Barang",content:r.a.createElement(n.Suspense,{fallback:r.a.createElement(l.a,{width:"100%",height:50,count:2})},r.a.createElement(j,{onSubmit:a=>this.handleModal(a),onSend:this.props.onSend,isEdit:this.state.isEdit}))})))}})},487:function(a,e,t){"use strict";t.d(e,"a",function(){return n});const n=a=>a?void 0:"Tidak Boleh Kosong"},502:function(a,e,t){"use strict";t.d(e,"a",function(){return i});var n=t(16),r=t.n(n);const i=(a,e)=>new Promise((t,n)=>{let i=JSON.parse(localStorage.getItem(a))||[];i.push(e),localStorage.setItem(a,JSON.stringify(i)),r.a.fire({position:"top-right",text:"Tambah Data Berhasil",timer:2e3,icon:"success",showConfirmButton:!1}).then(()=>t("Berhaisl")).catch(()=>n("GAGAL"))})}}]);
//# sourceMappingURL=21.f503d675.chunk.js.map